{% extends 'base_dashboard.html' %} {% load staticfiles %} {% block body%}

<div class="my-3 my-md-5">
    <div class="container">
        <div class="page-header" style="flex-direction: row;">
            <h1 class="page-title">Farmers' Biodata</h1>
            <div class="page-subtitle">1 - 20 of 20 farmers</div>
            <div class="page-options d-flex">
                <select class="form-control custom-select w-auto">
                    <option value="asc">Newest</option>
                    <option value="desc">Oldest</option>
                </select>
                <div class="input-icon ml-2">
                    <span class="input-icon-addon">
                        <i class="fe fe-search"></i>
                    </span>
                    <input type="text" class="form-control w-10" placeholder="Search farmers">
                </div>
            </div>
        </div>
        <div class="card">
            <div class="table-responsive">
                <div class="dimmer">
                    <!-- <div class="loader"></div> -->
                    <div class="dimmer-content">
                        <table class="table table-hover table-outline table-vcenter text-nowrap card-table">
                            <thead>
                                <tr>
                                    <th class="text-center w-1">
                                        <i class="fe fe-image"></i>
                                    </th>
                                    <th>Farmer Name</th>
                                    <th>State</th>
                                    <th>LGA</th>
                                    <th>Town/Village</th>
                                    <th class="text-center">Land Size (ha)</th>
                                    <th>Phone Number(s)</th>
                                    <th class="text-center">Age</th>
                                    <th class="text-center">
                                        <i class="icon-settings"></i>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="results">
                                {% for farmer in farmers %}
                                    <tr>
                                        <td class="text-center">
                                            <div class="avatar d-block" style="background-image: url({{ farmer.picture.url }})">
                                            </div>
                                        </td>
                                        <td>
                                            <p class="m-0">{{farmer.full_name }}</p>
                                            <div class="small text-muted">
                                                Registered: {{ farmer.birth_date }}
                                            </div>
                                        </td>
                                        <td>
                                            <div>{{ farmer.state }}</div>
                                        </td>
                                        <td>
                                            <div>{{ farmer.lga }}</div>
                                        </td>
                                        <td>
                                            <div>{{ farmer.town }}</div>
                                        </td>
                                        <td>
                                            <div class="clearfix">
                                                <div class="float-left">
                                                    <strong>{{ farmer.land_area }}</strong>
                                                </div>
                                                <div class="float-right">
                                                    <small class="text-muted">10%</small>
                                                </div>
                                            </div>
                                            <div class="progress progress-xs">
                                                <div class="progress-bar bg-yellow" role="progressbar" style="width: 10%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </td>
                                        <td>
                                            {{ farmer.phone_number }}, {{ farmer.phone_number_2}}
                                        </td>
                                        <td class="text-center">
                                            <div class="mx-auto chart-circle chart-circle-xs" data-value="${DOB(this.gsx$dateofbirth.$t) / 100}" data-thickness="3" data-color="blue">
                                                <canvas width="40" height="40"></canvas>
                                                <div class="chart-circle-value">{{ farmer.age }}</div>
                                            </div>
                                        </td>
                                        <td class="text-center">
                                            <div class="item-action dropdown">
                                                <a href="javascript:void(0)" data-toggle="dropdown" class="icon">
                                                    <i class="fe fe-more-vertical"></i>
                                                </a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                        {{ farmer.get_absolute_url }}
                                                    <a href="{{ farmer.get_absolute_url }}" id="navigator" class="dropdown-item">
                                                        <i class="dropdown-icon fe fe-eye"></i> View Full Profile </a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- <script>
                require(['jquery'], function ($) {
                    $(document).ready(function () {
                        // Create the XHR object.
                        function createCORSRequest(method, url) {
                            var xhr = new XMLHttpRequest();
                            if ("withCredentials" in xhr) {
                                // XHR for Chrome/Firefox/Opera/Safari.
                                xhr.open(method, url, true);
                            } else if (typeof XDomainRequest != "undefined") {
                                // XDomainRequest for IE.
                                xhr = new XDomainRequest();
                                xhr.open(method, url);
                            } else {
                                // CORS not supported.
                                xhr = null;
                            }
                            return xhr;
                        }
                        // ID of the Google Spreadsheet
                        var spreadsheetID = "1aZ8aYMpnsVpB6E0iOS5v_eX6sCloxLYlIvyJJoscurA";

                        var url =
                            `https://spreadsheets.google.com/feeds/list/${spreadsheetID}/1/public/values?alt=json`;

                        // Get picture
                        function getPic(url) {
                            var picId = (url.match(/[-\w]{25,}/))[0];
                            var picURL = `https://drive.google.com/thumbnail?authuser=0&sz=w320&id=${picId}`;
                            return picURL;
                        }

                        // Get date of birth
                        function DOB(dob) {
                            var today = new Date();
                            var currentYear = today.getFullYear();
                            var birthDate = new Date(dob);
                            var birthYear = birthDate.getFullYear();
                            var age = currentYear - birthYear;
                            return age;
                        }

                        // Get date of registration
                        function DOR(d) {
                            var fullDate = new Date(d);
                            var regMonth = fullDate.toString().split(' ')[1];
                            var regDay = fullDate.getDay();
                            var regYear = fullDate.getFullYear();
                            return `${regMonth} ${regDay}, ${regYear}`;
                            // console.log(regDay);
                        }

                        // Farm size - acres to hectares converter
                        function ath(a_size) {
                            var h_size = parseFloat(Math.round(0.4 * a_size));
                            return h_size;
                        }

                        // Display secondary phone number
                        function sph(num) {
                            if (num) {
                                return `, 0${num}`;
                            }
                        }

                        // Navigate to Farmer profile page
                        function navigateTo(url) {
                            var userId = (url.match(/[0-9a-zA-Z]{5}$/)[0]);
                            return userId;
                        }

                        // Make CORS Request
                        function makeCorsRequest() {
                            var xhr = createCORSRequest('GET', url);
                            if (!xhr) {
                                alert('CORS not supported');
                                return;
                            }

                            // Response handlers.
                            xhr.onreadystatechange = function () {
                                if (this.readyState === 4) {
                                    if (this.status === 200) {
                                        var data = JSON.parse(this.responseText);
                                        var entry = data.feed.entry;
                                        // console.log(entry);
                                        $(entry).each(function () {
                                            $('.results').prepend(`
                                    <tr>
                                    <td class="text-center">
                                        <div class="avatar d-block" style="background-image: url(${getPic(this.gsx$pictureoffarmer.$t)})">
                                        </div>
                                    </td>
                                    <td>
                                        <p class="m-0">${this.gsx$firstname.$t} ${this.gsx$lastname.$t}</p>
                                        <div class="small text-muted">
                                        Registered: ${DOR(this.title.$t)}
                                        </div>
                                    </td>
                                    <td>
                                        <div>${this.gsx$state.$t}</div>
                                    </td>
                                    <td>
                                        <div>${this.gsx$localgovernmentarealga.$t}</div>
                                    </td>
                                    <td>
                                        <div>${this.gsx$townorvillage.$t}</div>
                                    </td>
                                    <td>
                                        <div class="clearfix">
                                        <div class="float-left">
                                            <strong>${ath(this.gsx$totallandareaacres.$t)}</strong>
                                        </div>
                                        <div class="float-right">
                                            <small class="text-muted">10%</small>
                                        </div>
                                        </div>
                                        <div class="progress progress-xs">
                                        <div class="progress-bar bg-yellow" role="progressbar" style="width: 10%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>  
                                    </td>
                                    <td>
                                        0${this.gsx$primaryphonenumber.$t}${sph(this.gsx$secondaryphonenumberifavailable.$t)}
                                    </td>
                                    <td class="text-center">
                                        <div class="mx-auto chart-circle chart-circle-xs" data-value="${DOB(this.gsx$dateofbirth.$t) / 100}" data-thickness="3" data-color="blue"><canvas width="40" height="40"></canvas>
                                        <div class="chart-circle-value">${DOB(this.gsx$dateofbirth.$t)}</div>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <div class="item-action dropdown">
                                        <a href="javascript:void(0)" data-toggle="dropdown" class="icon"><i class="fe fe-more-vertical"></i></a>
                                        <div class="dropdown-menu dropdown-menu-right">
                                            <a href="" id="navigator" class="dropdown-item"><i class="dropdown-icon fe fe-eye"></i> View Full Profile </a>
                                        </div>
                                        </div>
                                    </td>
                                    </tr>
                                `);

                                            $(".dimmer").removeClass("active");

                                            var userUrl = this.id.$t;
                                            var a = document.getElementById('navigator');
                                            a.href = `./farmer-profile-full.html?${navigateTo(userUrl)}`;
                                        });
                                    } else {
                                        console.log("Unable to retrieve data");
                                    }
                                }
                            };
                            xhr.send();
                        }
                        //makeCorsRequest();
                    })
                })
            </script> -->
        </div>
    </div>
</div>

{% endblock %}