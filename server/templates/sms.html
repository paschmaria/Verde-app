{% extends 'base_dashboard.html' %}
{% load staticfiles %}

{% block body %}
<div class="my-3 my-md-5">
    <div class="container">
        <div class="row">
            <div class="col-md-3">
                <h3 class="page-title mb-5">Short Message Service (SMS)</h3>
                <div>
                    <div class="list-group list-group-transparent mb-0">
                        <!-- <a href="#" class="list-group-item list-group-item-action d-flex align-items-center active">
                            <span class="icon mr-3"><i class="fe fe-inbox"></i></span>Inbox <span class="ml-auto badge badge-primary">14</span>
                        </a> -->
                        <a href="{% url 'sms-history' %}" class="list-group-item list-group-item-action d-flex align-items-center">
                            <span class="icon mr-3"><i class="fe fe-send"></i></span>Sent Messages <span class="ml-auto badge badge-secondary">14</span>
                        </a>
                        <a href="{% url 'sms-reports' %}" class="list-group-item list-group-item-action d-flex align-items-center">
                            <span class="icon mr-3"><i class="fe fe-alert-circle"></i></span>Delivery Reports <span class="ml-auto badge badge-primary">3</span>
                        </a>
                        <a href="{% url 'sms-draft' %}" class="list-group-item list-group-item-action d-flex align-items-center">
                            <span class="icon mr-3"><i class="fe fe-file"></i></span>Drafts <span class="ml-auto badge badge-secondary">7</span>
                        </a>
                        <a href="{% url 'sms-trash' %}" class="list-group-item list-group-item-action d-flex align-items-center">
                            <span class="icon mr-3"><i class="fe fe-trash-2"></i></span>Trash <span class="ml-auto badge badge-secondary">1</span>
                        </a>
                    </div>
                    <div class="mt-6 mb-6">
                        <a href="{% url 'sms' %}" class="btn btn-secondary btn-block">Compose new SMS</a>
                    </div>
                </div>
            </div>
            <div class="col-md-9">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Compose new SMS</h3>
                    </div>
                    <div class="card-body">
                        <form method="post">
                            {% csrf_token %}
                            <div class="form-group">
                                <div class="row align-items-center">
                                    <label class="col-sm-2">To:</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="recipients" placeholder="Comma separated phone numbers..." required>
                                    </div>
                                </div>
                            </div>
                            <script>
                                require(['jquery', 'selectize'], function ($, selectize) {
                                    var REGEX_PHONE = '([0-9]{11}(?: |\-)|(?:\+|00)[0-9]{13}(?: |\-)|((?:[0-9]{2}){4})|((?: |\-)[0-9]{3}(?: |\-)[0-9]{4}))';

                                $('#recipients').selectize({
                                    persist: false,
                                    maxItems: null,
                                    valueField: 'phone',
                                    labelField: 'name',
                                    searchField: ['name', 'phone'],
                                    options: {{ phone_data|safe }}, 
                                    // options: [
                                    //     {phone: '+2348129023456', name: 'Musa Ibrahim'},
                                    //     {phone: '+2349098762345', name: 'Nurudeen Dawodu'},
                                    //     {phone: '+2348056785432', name: 'Ismail Samson'}
                                    // ],
                                    render: {
                                        item: function(item, escape) {
                                            return '<div>' +
                                                (item.name ? '<span class="name">' + escape(item.name) + '</span>' : '') +
                                                (item.phone ? '<span class="phone">' + escape(item.phone) + '</span>' : '') +
                                            '</div>';
                                        },
                                        option: function(item, escape) {
                                            var label = item.name;
                                            var caption = item.name ? item.phone : null;
                                            return '<div>' +
                                                '<span class="label">' + escape(label) + '</span>' +
                                                (caption ? '<span class="caption">' + escape(caption) + '</span>' : '') +
                                            '</div>';
                                        }
                                    },
                                    createFilter: function(input) {
                                        var match, regex;

                                            // phone
                                            regex = new RegExp('^' + REGEX_PHONE + '$', 'i');
                                            match = input.match(regex);
                                            if (match) return !this.options.hasOwnProperty(match[0]);

                                            // name <phone>
                                            regex = new RegExp('^([^<]*)\<' + REGEX_PHONE + '\>$', 'i');
                                            match = input.match(regex);
                                            if (match) return !this.options.hasOwnProperty(match[2]);

                                            return false;
                                        },
                                        create: function(input) {
                                            if ((new RegExp('^' + REGEX_PHONE + '$', 'i')).test(input)) {
                                                return {phone: input};
                                            }
                                            var match = input.match(new RegExp('^([^<]*)\<' + REGEX_PHONE + '\>$', 'i'));
                                            if (match) {
                                                return {
                                                    phone : match[2],
                                                    name  : $.trim(match[1])
                                                };
                                            }
                                            alert('Invalid Phone Number');
                                            return false;
                                        }
                                    });
                                })
                            </script>
                            <div class="form-group">
                                <div class="row align-items-center">
                                    <label class="col-sm-2">From:</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" required>
                                    </div>
                                </div>
                            </div>
                            <textarea rows="10" class="form-control" required></textarea>
                            <div class="d-flex justify-content-center">
                                <small class="mt-4 text-muted pl-2 w-25">4 min</small>
                                <div class="btn-list mt-4 text-right">
                                    <button type="button" class="btn btn-secondary btn-space">Save as Draft</button>
                                    <button type="submit" class="btn btn-primary btn-space">Send message</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
          